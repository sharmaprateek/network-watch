<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Network Watch — Device</title>
  <style>
    body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; margin: 24px; }
    code { background: #f6f6f6; padding: 2px 6px; border-radius: 6px; }
    a { color: #0b57d0; }
    .muted { color: #666; }
    pre { background: #f6f6f6; padding: 12px; border-radius: 8px; overflow-x: auto; }
  </style>
</head>
<body>
  <p><a href="/">← Back</a> · <a href="/timeline.html">Timeline</a> · <a href="/ip-history.html">IP history</a> · <a href="/churn.html">Churn</a> · <a href="/graph.html">Device↔Port graph</a></p>
  <h1 id="title">Device</h1>
  <div id="content" class="muted">Loading…</div>

<script>
(async function(){
  const params = new URLSearchParams(location.search);
  const id = params.get('id');
  const resp = await fetch('/latest.json', {cache:'no-store'}).catch(()=>null);
  if(!resp){ document.getElementById('content').innerText = 'Failed to load latest.json'; return; }
  const data = await resp.json();
  const dev = (data.devices||[]).find(d => d.id === id);
  if(!dev){ document.getElementById('content').innerText = 'Device not found in latest snapshot.'; return; }

  const title = (dev.name || dev.vendor || dev.id) + ' — ' + (dev.ip || '');
  document.getElementById('title').innerText = title;

  const lines = [];
  lines.push('Type: ' + (dev.type||''));
  lines.push('IP: ' + (dev.ip||''));
  lines.push('MAC: ' + (dev.mac||''));
  lines.push('Vendor: ' + (dev.vendor||''));
  if(dev.hostname) lines.push('Hostname: ' + dev.hostname);
  if((dev.mdns||[]).length) lines.push('mDNS hostnames: ' + dev.mdns.join(', '));
  if((dev.mdns_services||[]).length) lines.push('mDNS services: ' + dev.mdns_services.join(', '));
  if((dev.ssdp||[]).length) {
    lines.push('SSDP/UPnP:');
    (dev.ssdp||[]).slice(0,8).forEach(s => {
      lines.push('  - ' + (s.st||'') + ' | ' + (s.server||'') + ' | ' + (s.location||''));
    });
  }
  lines.push('');
  lines.push('Open ports:');
  (dev.open_ports||[]).forEach(p => lines.push('  - ' + p.raw));
  lines.push('');
  lines.push('Web probe:');
  (dev.web||[]).forEach(w => {
    lines.push('  - ' + (w.url||'') + ' status=' + (w.status||'') + ' server=' + (w.server||'') + ' title=' + (w.title||''));
  });
  lines.push('');
  lines.push('Risk flags: ' + (dev.risk_flags||[]).join(', '));

  document.getElementById('content').innerHTML = '<pre>' + lines.join('\n').replace(/[&<>]/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;"}[c])) + '</pre>';
})();
</script>
</body>
</html>
